/*
  Tencent is pleased to support the open source community by making Metis available.
  Copyright (C) 2018 THL A29 Limited, a Tencent company. All rights reserved.
  Licensed under the BSD 3-Clause License (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at
  https://opensource.org/licenses/BSD-3-Clause
  Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
*/

const moment = require('moment');
const CONFIG = require('../../constant.json');

Model('query', {
  data: {
    dateTime: [moment().year(2018).month(9).date(1).hour(0).minute(0).second(0), moment().year(2018).month(9).date(7).hour(23).minute(59).second(59)],
    viewName: '',
    attrName: '',
    currentPage: 1,
    pageSize: 6,
    pageSizeOptions: [6, 9, 12, 24],
    total: 0,
    defaultChartOption: {},
    loading: false,
    anomalyList: [],
    markFlagList: [],
    extendChart: {
      visible: false,
      option: {},
      title: '',
    },
    errMsg: '',
  },

  setData(info) {
    Object.assign(this.data, info);
  },

  getDefaultData(){
    var rowList=[];
    var row=['1', '2001', 'view_2001', '12001', 'attr_12001', '2018-10-03 10:09:05', '1390581,1405132,1382229,1362340,1360641,1344132,1367595,1326750,1352169,1361821,1341500,1312215,1360773,1256342,1326099,1232657,1311932,1246891,1171717,1221048,1216330,1199429,1271277,1223883,1181193,1257309,1207908,1255338,1233813,1240906,1166953,1232819,1348583,1129682,1172875,1097150,1060937,1054432,1039771,1113298,1039371,1016055,1004234,984761,1085000,1085954,1051592,1004637,1072340,1120887,983273,964993,968570,981446,953348,1055478,1110116,1006930,947557,955345,1018399,1232657,1343902,945753,961306,953846,985780,977939,1031549,997600,939142,931824,917546,897677,964058,917084,846475,895853,973910,835625,814776,845794,851606,854261,814340,810491,758873,801102,998653,822204,871105,711266,786061,675115,784371,725379,895946,815684,751276,725761,677854,669537,766652,706730,733002,785553,727440,682752,733039,656527,732194,703823,661209,694652,672808,667518,652475,616349,642579,682748,729586,728883,687006,719321,687051,654867,660754,619142,751479,665325,681654,712060,669891,640459,644545,655298,697301,681365,640562,578682,597710,585464,620248,686100,647384,636928,608144,659183,619637,572653,695129,690392,655684,571122,589629,604775,722810,640670,558900,606495,642452,597322,590852,591432,631844,630639,710564,741639,639822,635498,645442,652280,628141,530221,610360,557067,609462,621304,521751,617051,634743,592824,613052,495845,568150,558918,546160,593665,554383,547113,550458,643256,578032,488183,502153,473881,518286,599813,527972,501532,487741,533010,502704,468456,519138,550198,508348,619911,648138,585437,709011,828319,933586,718690,690100,548252,579797,540003,618817,684068,699632,787882,764422,760919,823215,636874,621737,551033,678515,671084,558824,507705,554759,551575,632866,744829,718436,581636,522110,505552,593495,564483,661822,584843,505540,553363,507898,585346,532044,607198,554093,569045,700454,589410,535039,462272,452381,501425,483092,490560,542712,639777,482128,504401,442434,479066,527794,540926,625976,515470,539795,550397,537291,525709,559207,529398,595886,486083,455200,543205,481007,523954,554869,432080,486776,444478,494207,558734,507057,518008,482272,477878,482557,479457,507188,491292,459723,503131,513268,483291,558385,513718,473893,500923,541546,580241,618273,531727,585961,607527,529293,623152,530416,556077,564314,574302,552556,572800,618698,556343,577399,613760,649359,621139,673588,643848,584547,648505,635569,605051,581732,641947,630471,583202,597014,644093,607104,612217,712184,640345,609324,640519,635123,636431,689093,637185,619884,690564,649025,658936,697498,659308,676029,656754,714538,710807,659210,653934,711738,705375,656812', '1586441,1618275,1572752,1563759,1616132,1651131,1674343,1800630,2063177,1672041,1599415,1532016,1544137,1497339,1439787,1511461,1491195,1503670,1451075,1409433,1467964,1483933,1373070,1472911,1381590,1629817,1578068,1504973,1391389,1382164,1384419,1360533,1416700,1347263,1317662,1296034,1396401,1427275,1290513,1239938,1237100,1270804,1192642,1239025,1152916,1231452,1226678,1273871,1191967,1155777,1221524,1277758,1188297,1149489,1209082,1233194,1222851,1683790,1174152,1176994,1095884,1106335,1093135,1122541,1053063,1081909,1151313,1126988,1120102,1220124,1114088,1073515,1063050,1093060,1069947,1184424,1056613,1009226,992176,1042657,1206278,1045981,1113882,1134757,1007620,1131455,1010201,1046241,1018107,1037836,939929,1011018,956471,905729,1073670,946914,936342,1045977,965916,922781,893435,932547,945378,858824,851542,962723,884597,939553,870805,855712,853254,855086,879236,833531,870555,808965,835849,822451,802440,826266,823996,780232,735844,862057,824805,904703,961282,936928,951143,933377,929040,867762,861482,807489,716671,728942,755340,753411,695181,781076,900323,904897,775567,818286,728502,780512,721041,756019,805258,865182,803310,756172,748897,662948,676063,771415,677236,759260,866246,711086,702109,726619,654822,669726,758698,761946,716297,761292,766796,792562,708456,710232,685112,719998,668082,746331,659770,720830,680804,758679,825715,781324,790507,702870,713846,726935,647423,724338,734655,711023,727108,724691,733876,668249,624881,630538,592461,641217,697214,610116,615232,675947,660848,743718,717103,659639,663681,669557,733948,677490,774297,696172,693294,753884,657709,692954,651041,656626,728296,649349,639495,628498,675050,661863,669270,683332,761847,744794,766252,741714,672663,688970,721311,680009,640487,625235,654201,664879,630597,564134,630394,647241,643823,648854,665744,674525,654810,633907,670682,632294,608427,596589,585872,573057,583750,662630,628358,591922,608416,591712,630640,580395,598037,595672,605060,590914,624146,593771,685125,665729,606020,587875,681209,660469,597770,569973,584307,525090,582992,622717,601983,568700,579758,556630,567395,689696,601870,593179,580241,596208,583791,559743,614467,555148,661054,594042,651685,568276,531668,568701,534358,588987,625448,608165,557348,701015,733630,684764,820198,740198,690177,638350,625170,607605,638086,698874,677267,664745,750141,662725,650448,667685,688372,672092,730825,699005,641162,673138,735619,882980,752719,679833,798191,831563,818339,817200,742106,672135,678275,727605,714015,668226,761825,775151,848426,801136,768454,810060,798886,796490,843866,781072,762958,725746,802379,888902,921209,815130,824882,741029,766292', '1633334,1615123,1587947,1672602,1730335,1681593,1811658,1958494,1720471,1749899,1803779,1660931,1725655,1644444,1667930,1683492,1630451,1659362,1605138,1611363,1656886,1488085,1570751,1556689,1626803,1653958,1752028,1688631,1654717,1590311,1702552,1536257,1555483,1459178,1453499,1580195,1446176,1388162,1438292,1495040,1440349,1421932,1419205,1445149,1382942,1376046,1384061,1329428,1351546,1407362,1427099,1327828,1230727,1271027,1265087,1540692,1500728,1460980,1399510,1297224,1315566,1733499,1330202,1241386,1201562,1351841,1255991,1296255,1385394,1303679,1297755,1239613,1206618,1213377,1282023,1297846,1333406,1286225,1195068,1194936,1252461,1220336,1197211,1174456,1236446,1345603,1220611,1204092,1153884,1112519,1101156,1141960,1116574,1074753,1121803,1259009,1132741,1155971,1054259,1327345,1034615,1064170,1049932,1006827,987933,1080603,1090482,1128541,1218674,1136353,1090228,1060444,995513,1045212,1009457,1036946,1001349,1000136,961733,997418,983013,992234,993116,1035023,959944,960079,952268,1050297,991605,990490,1074227,968169,966275,923228,908228,963375,946137,954515,907328,876052,878960,874005,850753,928953,900236,932778,888667,910301,982485,882244,973483,964683,852878,840955,846295,1002783,1284931,1877011,1939730,1880257,1882392,1798396,1865148,2964638,2961361,2999967,2828377,2876494,3008489,2891245,2868106,2892818,2830200,2939390,2959417,3058358,2795210,2828645,2803238,2879777,2779045','0',
     '12002', 'attr_12002', '2018-10-03 10:09:05', '1390581,1405132,1382229,1362340,1360641,1344132,1367595,1326750,1352169,1361821,1341500,1312215,1360773,1256342,1326099,1232657,1311932,1246891,1171717,1221048,1216330,1199429,1271277,1223883,1181193,1257309,1207908,1255338,1233813,1240906,1166953,1232819,1348583,1129682,1172875,1097150,1060937,1054432,1039771,1113298,1039371,1016055,1004234,984761,1085000,1085954,1051592,1004637,1072340,1120887,983273,964993,968570,981446,953348,1055478,1110116,1006930,947557,955345,1018399,1232657,1343902,945753,961306,953846,985780,977939,1031549,997600,939142,931824,917546,897677,964058,917084,846475,895853,973910,835625,814776,845794,851606,854261,814340,810491,758873,801102,998653,822204,871105,711266,786061,675115,784371,725379,895946,815684,751276,725761,677854,669537,766652,706730,733002,785553,727440,682752,733039,656527,732194,703823,661209,694652,672808,667518,652475,616349,642579,682748,729586,728883,687006,719321,687051,654867,660754,619142,751479,665325,681654,712060,669891,640459,644545,655298,697301,681365,640562,578682,597710,585464,620248,686100,647384,636928,608144,659183,619637,572653,695129,690392,655684,571122,589629,604775,722810,640670,558900,606495,642452,597322,590852,591432,631844,630639,710564,741639,639822,635498,645442,652280,628141,530221,610360,557067,609462,621304,521751,617051,634743,592824,613052,495845,568150,558918,546160,593665,554383,547113,550458,643256,578032,488183,502153,473881,518286,599813,527972,501532,487741,533010,502704,468456,519138,550198,508348,619911,648138,585437,709011,828319,933586,718690,690100,548252,579797,540003,618817,684068,699632,787882,764422,760919,823215,636874,621737,551033,678515,671084,558824,507705,554759,551575,632866,744829,718436,581636,522110,505552,593495,564483,661822,584843,505540,553363,507898,585346,532044,607198,554093,569045,700454,589410,535039,462272,452381,501425,483092,490560,542712,639777,482128,504401,442434,479066,527794,540926,625976,515470,539795,550397,537291,525709,559207,529398,595886,486083,455200,543205,481007,523954,554869,432080,486776,444478,494207,558734,507057,518008,482272,477878,482557,479457,507188,491292,459723,503131,513268,483291,558385,513718,473893,500923,541546,580241,618273,531727,585961,607527,529293,623152,530416,556077,564314,574302,552556,572800,618698,556343,577399,613760,649359,621139,673588,643848,584547,648505,635569,605051,581732,641947,630471,583202,597014,644093,607104,612217,712184,640345,609324,640519,635123,636431,689093,637185,619884,690564,649025,658936,697498,659308,676029,656754,714538,710807,659210,653934,711738,705375,656812', '1586441,1618275,1572752,1563759,1616132,1651131,1674343,1800630,2063177,1672041,1599415,1532016,1544137,1497339,1439787,1511461,1491195,1503670,1451075,1409433,1467964,1483933,1373070,1472911,1381590,1629817,1578068,1504973,1391389,1382164,1384419,1360533,1416700,1347263,1317662,1296034,1396401,1427275,1290513,1239938,1237100,1270804,1192642,1239025,1152916,1231452,1226678,1273871,1191967,1155777,1221524,1277758,1188297,1149489,1209082,1233194,1222851,1683790,1174152,1176994,1095884,1106335,1093135,1122541,1053063,1081909,1151313,1126988,1120102,1220124,1114088,1073515,1063050,1093060,1069947,1184424,1056613,1009226,992176,1042657,1206278,1045981,1113882,1134757,1007620,1131455,1010201,1046241,1018107,1037836,939929,1011018,956471,905729,1073670,946914,936342,1045977,965916,922781,893435,932547,945378,858824,851542,962723,884597,939553,870805,855712,853254,855086,879236,833531,870555,808965,835849,822451,802440,826266,823996,780232,735844,862057,824805,904703,961282,936928,951143,933377,929040,867762,861482,807489,716671,728942,755340,753411,695181,781076,900323,904897,775567,818286,728502,780512,721041,756019,805258,865182,803310,756172,748897,662948,676063,771415,677236,759260,866246,711086,702109,726619,654822,669726,758698,761946,716297,761292,766796,792562,708456,710232,685112,719998,668082,746331,659770,720830,680804,758679,825715,781324,790507,702870,713846,726935,647423,724338,734655,711023,727108,724691,733876,668249,624881,630538,592461,641217,697214,610116,615232,675947,660848,743718,717103,659639,663681,669557,733948,677490,774297,696172,693294,753884,657709,692954,651041,656626,728296,649349,639495,628498,675050,661863,669270,683332,761847,744794,766252,741714,672663,688970,721311,680009,640487,625235,654201,664879,630597,564134,630394,647241,643823,648854,665744,674525,654810,633907,670682,632294,608427,596589,585872,573057,583750,662630,628358,591922,608416,591712,630640,580395,598037,595672,605060,590914,624146,593771,685125,665729,606020,587875,681209,660469,597770,569973,584307,525090,582992,622717,601983,568700,579758,556630,567395,689696,601870,593179,580241,596208,583791,559743,614467,555148,661054,594042,651685,568276,531668,568701,534358,588987,625448,608165,557348,701015,733630,684764,820198,740198,690177,638350,625170,607605,638086,698874,677267,664745,750141,662725,650448,667685,688372,672092,730825,699005,641162,673138,735619,882980,752719,679833,798191,831563,818339,817200,742106,672135,678275,727605,714015,668226,761825,775151,848426,801136,768454,810060,798886,796490,843866,781072,762958,725746,802379,888902,921209,815130,824882,741029,766292', '1633334,1615123,1587947,1672602,1730335,1681593,1811658,1958494,1720471,1749899,1803779,1660931,1725655,1644444,1667930,1683492,1630451,1659362,1605138,1611363,1656886,1488085,1570751,1556689,1626803,1653958,1752028,1688631,1654717,1590311,1702552,1536257,1555483,1459178,1453499,1580195,1446176,1388162,1438292,1495040,1440349,1421932,1419205,1445149,1382942,1376046,1384061,1329428,1351546,1407362,1427099,1327828,1230727,1271027,1265087,1540692,1500728,1460980,1399510,1297224,1315566,1733499,1330202,1241386,1201562,1351841,1255991,1296255,1385394,1303679,1297755,1239613,1206618,1213377,1282023,1297846,1333406,1286225,1195068,1194936,1252461,1220336,1197211,1174456,1236446,1345603,1220611,1204092,1153884,1112519,1101156,1141960,1116574,1074753,1121803,1259009,1132741,1155971,1054259,1327345,1034615,1064170,1049932,1006827,987933,1080603,1090482,1128541,1218674,1136353,1090228,1060444,995513,1045212,1009457,1036946,1001349,1000136,961733,997418,983013,992234,993116,1035023,959944,960079,952268,1050297,991605,990490,1074227,968169,966275,923228,908228,963375,946137,954515,907328,876052,878960,874005,850753,928953,900236,932778,888667,910301,982485,882244,973483,964683,852878,840955,846295,1002783,1284931,1877011,1939730,1880257,1882392,1798396,1865148,2964638,2961361,2999967,2828377,2876494,3008489,2891245,2868106,2892818,2830200,2939390,2959417,3058358,2795210,2828645,2803238,2879777,2779045','0',
    ];
    var row1=['2', '2002', 'view_2002', '22001', 'attr_22001', '2018-10-03 10:29:05', '2390581,1405132,1382229,1362340,2360641,1344132,1367595,1326750,2352169,1361821,1341500,1312215,1360773,1256342,1326099,1232657,1311932,1246891,1171717,1221048,1216330,1199429,1271277,1223883,2181193,1257309,1207908,1255338,1233813,1240906,1166953,1232819,1348583,1129682,1172875,1097150,1060937,1054432,1039771,1113298,1039371,1016055,1004234,984761,1085000,1085954,1051592,1004637,1072340,1120887,983273,964993,968570,981446,953348,1055478,1110116,1006930,947557,955345,1018399,1232657,1343902,945753,961306,953846,985780,977939,1031549,997600,939142,931824,917546,897677,964058,917084,846475,895853,973910,835625,814776,845794,851606,854261,814340,810491,758873,801102,998653,822204,871105,711266,786061,675115,784371,725379,895946,815684,751276,725761,677854,669537,766652,706730,733002,785553,727440,682752,733039,656527,732194,703823,661209,694652,672808,667518,652475,616349,642579,682748,729586,728883,687006,719321,687051,654867,660754,619142,751479,665325,681654,712060,669891,640459,644545,655298,697301,681365,640562,578682,597710,585464,620248,686100,647384,636928,608144,659183,619637,572653,695129,690392,655684,571122,589629,604775,722810,640670,558900,606495,642452,597322,590852,591432,631844,630639,710564,741639,639822,635498,645442,652280,628141,530221,610360,557067,609462,621304,521751,617051,634743,592824,613052,495845,568150,558918,546160,593665,554383,547113,550458,643256,578032,488183,502153,473881,518286,599813,527972,501532,487741,533010,502704,468456,519138,550198,508348,619911,648138,585437,709011,828319,933586,718690,690100,548252,579797,540003,618817,684068,699632,787882,764422,760919,823215,636874,621737,551033,678515,671084,558824,507705,554759,551575,632866,744829,718436,581636,522110,505552,593495,564483,661822,584843,505540,553363,507898,585346,532044,607198,554093,569045,700454,589410,535039,462272,452381,501425,483092,490560,542712,639777,482128,504401,442434,479066,527794,540926,625976,515470,539795,550397,537291,525709,559207,529398,595886,486083,455200,543205,481007,523954,554869,432080,486776,444478,494207,558734,507057,518008,482272,477878,482557,479457,507188,491292,459723,503131,513268,483291,558385,513718,473893,500923,541546,580241,618273,531727,585961,607527,529293,623152,530416,556077,564314,574302,552556,572800,618698,556343,577399,613760,649359,621139,673588,643848,584547,648505,635569,605051,581732,641947,630471,583202,597014,644093,607104,612217,712184,640345,609324,640519,635123,636431,689093,637185,619884,690564,649025,658936,697498,659308,676029,656754,714538,710807,659210,653934,711738,705375,656812', '1586441,1618275,1572752,1563759,1616132,1651131,1674343,1800630,2063177,1672041,1599415,1532016,1544137,1497339,1439787,1511461,1491195,1503670,1451075,1409433,1467964,1483933,1373070,1472911,1381590,1629817,1578068,1504973,1391389,1382164,1384419,1360533,1416700,1347263,1317662,1296034,1396401,1427275,1290513,1239938,1237100,1270804,1192642,1239025,1152916,1231452,1226678,1273871,1191967,1155777,1221524,1277758,1188297,1149489,1209082,1233194,1222851,1683790,1174152,1176994,1095884,1106335,1093135,1122541,1053063,1081909,1151313,1126988,1120102,1220124,1114088,1073515,1063050,1093060,1069947,1184424,1056613,1009226,992176,1042657,1206278,1045981,1113882,1134757,1007620,1131455,1010201,1046241,1018107,1037836,939929,1011018,956471,905729,1073670,946914,936342,1045977,965916,922781,893435,932547,945378,858824,851542,962723,884597,939553,870805,855712,853254,855086,879236,833531,870555,808965,835849,822451,802440,826266,823996,780232,735844,862057,824805,904703,961282,936928,951143,933377,929040,867762,861482,807489,716671,728942,755340,753411,695181,781076,900323,904897,775567,818286,728502,780512,721041,756019,805258,865182,803310,756172,748897,662948,676063,771415,677236,759260,866246,711086,702109,726619,654822,669726,758698,761946,716297,761292,766796,792562,708456,710232,685112,719998,668082,746331,659770,720830,680804,758679,825715,781324,790507,702870,713846,726935,647423,724338,734655,711023,727108,724691,733876,668249,624881,630538,592461,641217,697214,610116,615232,675947,660848,743718,717103,659639,663681,669557,733948,677490,774297,696172,693294,753884,657709,692954,651041,656626,728296,649349,639495,628498,675050,661863,669270,683332,761847,744794,766252,741714,672663,688970,721311,680009,640487,625235,654201,664879,630597,564134,630394,647241,643823,648854,665744,674525,654810,633907,670682,632294,608427,596589,585872,573057,583750,662630,628358,591922,608416,591712,630640,580395,598037,595672,605060,590914,624146,593771,685125,665729,606020,587875,681209,660469,597770,569973,584307,525090,582992,622717,601983,568700,579758,556630,567395,689696,601870,593179,580241,596208,583791,559743,614467,555148,661054,594042,651685,568276,531668,568701,534358,588987,625448,608165,557348,701015,733630,684764,820198,740198,690177,638350,625170,607605,638086,698874,677267,664745,750141,662725,650448,667685,688372,672092,730825,699005,641162,673138,735619,882980,752719,679833,798191,831563,818339,817200,742106,672135,678275,727605,714015,668226,761825,775151,848426,801136,768454,810060,798886,796490,843866,781072,762958,725746,802379,888902,921209,815130,824882,741029,766292', '1633334,1615123,1587947,1672602,1730335,1681593,1811658,1958494,1720471,1749899,1803779,1660931,1725655,1644444,1667930,1683492,1630451,1659362,1605138,1611363,1656886,1488085,1570751,1556689,1626803,1653958,1752028,1688631,1654717,1590311,1702552,1536257,1555483,1459178,1453499,1580195,1446176,1388162,1438292,1495040,1440349,1421932,1419205,1445149,1382942,1376046,1384061,1329428,1351546,1407362,1427099,1327828,1230727,1271027,1265087,1540692,1500728,1460980,1399510,1297224,1315566,1733499,1330202,1241386,1201562,1351841,1255991,1296255,1385394,1303679,1297755,1239613,1206618,1213377,1282023,1297846,1333406,1286225,1195068,1194936,1252461,1220336,1197211,1174456,1236446,1345603,1220611,1204092,1153884,1112519,1101156,1141960,1116574,1074753,1121803,1259009,1132741,1155971,1054259,1327345,1034615,1064170,1049932,1006827,987933,1080603,1090482,1128541,1218674,1136353,1090228,1060444,995513,1045212,1009457,1036946,1001349,1000136,961733,997418,983013,992234,993116,1035023,959944,960079,952268,1050297,991605,990490,1074227,968169,966275,923228,908228,963375,946137,954515,907328,876052,878960,874005,850753,928953,900236,932778,888667,910301,982485,882244,973483,964683,852878,840955,846295,1002783,1284931,1877011,1939730,1880257,1882392,1798396,1865148,2964638,2961361,2999967,2828377,2876494,3008489,2891245,2868106,2892818,2830200,2939390,2959417,3058358,2795210,2828645,2803238,3879777,2779045','0',
    '22002', 'attr_22002', '2018-10-03 10:29:05', '1390581,1405132,1382229,1362340,1360641,1344132,1367595,1326750,1352169,1361821,1341500,1312215,1360773,1256342,1326099,1232657,1311932,1246891,1171717,1221048,1216330,1199429,1271277,1223883,1181193,1257309,1207908,1255338,1233813,1240906,1166953,1232819,1348583,1129682,1172875,1097150,1060937,1054432,1039771,1113298,1039371,1016055,1004234,984761,1085000,1085954,1051592,1004637,1072340,1120887,983273,964993,968570,981446,953348,1055478,1110116,1006930,947557,955345,1018399,1232657,1343902,945753,961306,953846,985780,977939,1031549,997600,939142,931824,917546,897677,964058,917084,846475,895853,973910,835625,814776,845794,851606,854261,814340,810491,758873,801102,998653,822204,871105,711266,786061,675115,784371,725379,895946,815684,751276,725761,677854,669537,766652,706730,733002,785553,727440,682752,733039,656527,732194,703823,661209,694652,672808,667518,652475,616349,642579,682748,729586,728883,687006,719321,687051,654867,660754,619142,751479,665325,681654,712060,669891,640459,644545,655298,697301,681365,640562,578682,597710,585464,620248,686100,647384,636928,608144,659183,619637,572653,695129,690392,655684,571122,589629,604775,722810,640670,558900,606495,642452,597322,590852,591432,631844,630639,710564,741639,639822,635498,645442,652280,628141,530221,610360,557067,609462,621304,521751,617051,634743,592824,613052,495845,568150,558918,546160,593665,554383,547113,550458,643256,578032,488183,502153,473881,518286,599813,527972,501532,487741,533010,502704,468456,519138,550198,508348,619911,648138,585437,709011,828319,933586,718690,690100,548252,579797,540003,618817,684068,699632,787882,764422,760919,823215,636874,621737,551033,678515,671084,558824,507705,554759,551575,632866,744829,718436,581636,522110,505552,593495,564483,661822,584843,505540,553363,507898,585346,532044,607198,554093,569045,700454,589410,535039,462272,452381,501425,483092,490560,542712,639777,482128,504401,442434,479066,527794,540926,625976,515470,539795,550397,537291,525709,559207,529398,595886,486083,455200,543205,481007,523954,554869,432080,486776,444478,494207,558734,507057,518008,482272,477878,482557,479457,507188,491292,459723,503131,513268,483291,558385,513718,473893,500923,541546,580241,618273,531727,585961,607527,529293,623152,530416,556077,564314,574302,552556,572800,618698,556343,577399,613760,649359,621139,673588,643848,584547,648505,635569,605051,581732,641947,630471,583202,597014,644093,607104,612217,712184,640345,609324,640519,635123,636431,689093,637185,619884,690564,649025,658936,697498,659308,676029,656754,714538,710807,659210,653934,711738,705375,656812', '1586441,1618275,1572752,1563759,1616132,1651131,1674343,1800630,2063177,1672041,1599415,1532016,1544137,1497339,1439787,1511461,1491195,1503670,1451075,1409433,1467964,1483933,1373070,1472911,1381590,1629817,1578068,1504973,1391389,1382164,1384419,1360533,1416700,1347263,1317662,1296034,1396401,1427275,1290513,1239938,1237100,1270804,1192642,1239025,1152916,1231452,1226678,1273871,1191967,1155777,1221524,1277758,1188297,1149489,1209082,1233194,1222851,1683790,1174152,1176994,1095884,1106335,1093135,1122541,1053063,1081909,1151313,1126988,1120102,1220124,1114088,1073515,1063050,1093060,1069947,1184424,1056613,1009226,992176,1042657,1206278,1045981,1113882,1134757,1007620,1131455,1010201,1046241,1018107,1037836,939929,1011018,956471,905729,1073670,946914,936342,1045977,965916,922781,893435,932547,945378,858824,851542,962723,884597,939553,870805,855712,853254,855086,879236,833531,870555,808965,835849,822451,802440,826266,823996,780232,735844,862057,824805,904703,961282,936928,951143,933377,929040,867762,861482,807489,716671,728942,755340,753411,695181,781076,900323,904897,775567,818286,728502,780512,721041,756019,805258,865182,803310,756172,748897,662948,676063,771415,677236,759260,866246,711086,702109,726619,654822,669726,758698,761946,716297,761292,766796,792562,708456,710232,685112,719998,668082,746331,659770,720830,680804,758679,825715,781324,790507,702870,713846,726935,647423,724338,734655,711023,727108,724691,733876,668249,624881,630538,592461,641217,697214,610116,615232,675947,660848,743718,717103,659639,663681,669557,733948,677490,774297,696172,693294,753884,657709,692954,651041,656626,728296,649349,639495,628498,675050,661863,669270,683332,761847,744794,766252,741714,672663,688970,721311,680009,640487,625235,654201,664879,630597,564134,630394,647241,643823,648854,665744,674525,654810,633907,670682,632294,608427,596589,585872,573057,583750,662630,628358,591922,608416,591712,630640,580395,598037,595672,605060,590914,624146,593771,685125,665729,606020,587875,681209,660469,597770,569973,584307,525090,582992,622717,601983,568700,579758,556630,567395,689696,601870,593179,580241,596208,583791,559743,614467,555148,661054,594042,651685,568276,531668,568701,534358,588987,625448,608165,557348,701015,733630,684764,820198,740198,690177,638350,625170,607605,638086,698874,677267,664745,750141,662725,650448,667685,688372,672092,730825,699005,641162,673138,735619,882980,752719,679833,798191,831563,818339,817200,742106,672135,678275,727605,714015,668226,761825,775151,848426,801136,768454,810060,798886,796490,843866,781072,762958,725746,802379,888902,921209,815130,824882,741029,766292', '1633334,1615123,1587947,1672602,1730335,1681593,1811658,1958494,1720471,1749899,1803779,1660931,1725655,1644444,1667930,1683492,1630451,1659362,1605138,1611363,1656886,1488085,1570751,1556689,1626803,1653958,1752028,1688631,1654717,1590311,1702552,1536257,1555483,1459178,1453499,1580195,1446176,1388162,1438292,1495040,1440349,1421932,1419205,1445149,1382942,1376046,1384061,1329428,1351546,1407362,1427099,1327828,1230727,1271027,1265087,1540692,1500728,1460980,1399510,1297224,1315566,1733499,1330202,1241386,1201562,1351841,1255991,1296255,1385394,1303679,1297755,1239613,1206618,1213377,1282023,1297846,1333406,1286225,1195068,1194936,1252461,1220336,1197211,1174456,1236446,1345603,1220611,1204092,1153884,1112519,1101156,1141960,1116574,1074753,1121803,1259009,1132741,1155971,1054259,1327345,1034615,1064170,1049932,1006827,987933,1080603,1090482,1128541,1218674,1136353,1090228,1060444,995513,1045212,1009457,1036946,1001349,1000136,961733,997418,983013,992234,993116,1035023,959944,960079,952268,1050297,991605,990490,1074227,968169,966275,923228,908228,963375,946137,954515,907328,876052,878960,874005,850753,928953,900236,932778,888667,910301,982485,882244,973483,964683,852878,840955,846295,1002783,1284931,1877011,1939730,1880257,1882392,1798396,1865148,2964638,2961361,2999967,2828377,2876494,3008489,2891245,2868106,2892818,2830200,2939390,2959417,3058358,2795210,2828645,2803238,2879777,2779045','0',
    ]
    var anomalyList=[];
    anomalyList[0]={
        "id": row[0],
        "viewId": row[1],
        "viewName": row[2],
        "attrId": row[3],
        "attrName": row[4],
        "time": row[5],
        "dataC": row[6].split(","),
        "dataB": row[7].split(","),
        "dataA": row[8].split(","),
        "markFlag": row[9],
        "attrId2": row[10],
        "attrName2": row[11],
        "time2": row[12],
        "dataF": row[13].split(","),
        "dataE": row[14].split(","),
        "dataD": row[15].split(","),
        "markFlag2": row[16],
    };
    anomalyList[1]={
        "id": row1[0],
        "viewId": row1[1],
        "viewName": row1[2],
        "attrId": row1[3],
        "attrName": row1[4],
        "time1": row1[5],
        "dataC": row1[6].split(","),
        "dataB": row1[7].split(","),
        "dataA": row1[8].split(","),
        "markFlag": row1[9],
        "attrId2": row1[10],
        "attrName2": row1[11],
        "time2": row1[12],
        "dataF": row1[13].split(","),
        "dataE": row1[14].split(","),
        "dataD": row1[15].split(","),
        "markFlag2": row1[16],
    };
    console.log(row[0]);
    console.log(row[1]);
    console.log(anomalyList[0].id);
    console.log(anomalyList[0].time);
    console.log(anomalyList[0].dataD);

          this.setData({
            anomalyList: anomalyList.map((item) => {
              console.log(typeof(item.time1));
              var time='';
              if(item.time1){
                time=item.time1.replace(new RegExp(/-/gm) ,"/");
              }
              const anomalyTime = moment.unix(time);
              let chartOption = _.cloneDeep(this.data.defaultChartOption);
              chartOption.xAxis.data = this.getXAsixList(item.time1, item.dataA.length - 1);
              chartOption.series[0].data = item.dataA;
              chartOption.series[1].data = item.dataB;
              chartOption.series[2].data = item.dataC;
              chartOption.series[0].markLine = {
                silent: true,
                symbol: 'circle',
                lineStyle: {
                  normal: { color: '#e54545', width: 1, type: 'dotted', opacity: 0.8 },
                },
                data: [{ xAxis: anomalyTime.format('HH:mm') }],
                label: {
                  formatter: (params) => {
                    return anomalyTime.format('YYYY-MM-DD HH:mm');
                  },
                },
              };

              //添加多指标

              chartOption.series[3].data = item.dataD;
              chartOption.series[4].data = item.dataE;
              chartOption.series[5].data = item.dataF;

              chartOption.series[3].markLine = {
                silent: true,
                symbol: 'circle',
                lineStyle: {
                  normal: { color: '#ffffff', width: 1, type: 'dotted', opacity: 0.8 },
                },
                data: [{ xAxis: anomalyTime.format('HH:mm') }],
                label: {
                  formatter: (params) => {
                    return anomalyTime.format('YYYY-MM-DD HH:mm');
                  },
                },
              };

              item.chartOption = chartOption;
              return item;
            }),
            // total: totalCount,
            errMsg: '',
          });
  },
  queryAnomalyList() {
    this.setData({ loading: true });
    const { currentPage, pageSize, viewName, attrName, dateTime } = this.data;
    let params = { requestPage: currentPage, itemPerPage: pageSize, beginTime: dateTime[0].unix(), endTime: dateTime[1].unix(), attrId: attrName, viewId: viewName };
    uw.request({
      url: '/SearchAnomaly',
      method: 'POST',
      data: params,
      success: ({ code, data, msg }) => {
        if (code === 0) {
          const { totalCount, anomalyList = [] } = data;
          this.setData({
            anomalyList: anomalyList.map((item) => {
              const anomalyTime = moment.unix(parseInt(item.time));
              let chartOption = _.cloneDeep(this.data.defaultChartOption);
              chartOption.xAxis.data = this.getXAsixList(item.time, item.dataA.length - 1);
              chartOption.series[0].data = item.dataA;
              chartOption.series[1].data = item.dataB;
              chartOption.series[2].data = item.dataC;
              chartOption.series[0].markLine = {
                silent: true,
                symbol: 'circle',
                lineStyle: {
                  normal: { color: '#e54545', width: 1, type: 'dotted', opacity: 0.8 },
                },
                data: [{ xAxis: anomalyTime.format('HH:mm') }],
                label: {
                  formatter: (params) => {
                    return anomalyTime.format('YYYY-MM-DD HH:mm');
                  },
                },
              };
              item.chartOption = chartOption;
              return item;
            }),
            total: totalCount,
            errMsg: '',
          });
        } else {
          this.setData({
            anomalyList: [],
            total: 0,
            errMsg: msg,
          });
        }
        this.setData({ loading: false });
      },
    });
  },

  getXAsixList(anomalyTimeUnix, length) {
    const xAxisList = [moment.unix(anomalyTimeUnix).format('HH:mm')];
    for (let i = 1; i <= length; i++) {
      xAxisList.push(moment.unix(anomalyTimeUnix).add(i, 'm').format('HH:mm'));
      xAxisList.unshift(moment.unix(anomalyTimeUnix).subtract(i, 'm').format('HH:mm'));
    }
    return xAxisList;
  },

  updateMarkFlag(newMarkFlag, id) {
    let markFlagList = _.cloneDeep(this.data.markFlagList);
    markFlagList.push({ newMarkFlag, id });
    this.setData({ markFlagList });
    uw.request({
      url: '/UpdateAnomaly',
      method: 'POST',
      data: { id, markFlag: newMarkFlag },
      success: ({ code, data, msg }) => {
        if (code === 0) {
          let anomalyList = _.cloneDeep(this.data.anomalyList);
          for (let i = 0; i < anomalyList.length; i++) {
            if (anomalyList[i].id === id) {
              anomalyList[i].markFlag = newMarkFlag;
              break;
            }
          }
          this.setData({ anomalyList });
        } else {
          Notification.error({ title: newMarkFlag === 0 ? '取消标记失败' : '标记失败', content: msg, delay: CONFIG.errorDelay });
        }
        let markFlagList = _.cloneDeep(this.data.markFlagList);
        _.remove(markFlagList, (item) => item.id === id);
        this.setData({ markFlagList });
      },
    });
  }
})